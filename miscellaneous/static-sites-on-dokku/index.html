
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../pydata-landscape/">
      
      
        <link rel="next" href="../code-style-tools/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>Static Sites and Apps On Your Own Dokku Server - Essays on Data Science</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@7.1.2/dist/mermaid.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#static-sites-and-apps-on-your-own-dokku-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Essays on Data Science" class="md-header__button md-logo" aria-label="Essays on Data Science" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Essays on Data Science
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Static Sites and Apps On Your Own Dokku Server
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ericmjl/essays-on-data-science" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ericmjl/essays-on-data-science
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Essays on Data Science" class="md-nav__button md-logo" aria-label="Essays on Data Science" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Essays on Data Science
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ericmjl/essays-on-data-science" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ericmjl/essays-on-data-science
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Computing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Computing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computing/recursion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recursion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Machine Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/computational-bayesian-stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    An Introduction to Probability and Computational Bayesian Statistics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/markov-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Markov Models From The Bottom Up, with Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/generating-markov-chains-dirichlet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dirichlet Processes and Hidden Markov Model Transition Matrices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/message-passing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computational Representations of Message Passing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/reimplementing-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reimplementing and Testing Deep Learning Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/differential-computing-jax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Differential Computing Explained
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/nngp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infinitely Wide Neural Networks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/graph-nets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    An Attempt at Demystifying Graph Deep Learning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../machine-learning/llm-dev-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A Developer-First Guide to LLM APIs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Miscellaneous
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Miscellaneous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dashboarding-landscape/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A Review of the Python Data Science Dashboarding Landscape in 2019
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../learning-to-learn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How I Learned to Learn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../pydata-landscape/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    An Opinionated and Unofficial Guide to the PyData Ecosystem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Static Sites and Apps On Your Own Dokku Server
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Static Sites and Apps On Your Own Dokku Server
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#but-but-why" class="md-nav__link">
    But, but why?
  </a>
  
    <nav class="md-nav" aria-label="But, but why?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-youre-part-of-a-company" class="md-nav__link">
    If you're part of a company...
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-youre-doing-this-for-your-hobby-projects" class="md-nav__link">
    If you're doing this for your hobby projects...
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-generally" class="md-nav__link">
    More generally...
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-a-box-in-the-cloud-optional-if-you-have-one" class="md-nav__link">
    Set up a Box in the Cloud (optional if you have one)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-dokku-on-your-shiny-rented-machine" class="md-nav__link">
    Setup Dokku on your Shiny Rented Machine
  </a>
  
    <nav class="md-nav" aria-label="Setup Dokku on your Shiny Rented Machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-the-dokku-installation-commands" class="md-nav__link">
    Run the Dokku installation commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrap-up-dokku-installation" class="md-nav__link">
    Wrap up Dokku installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-that-dokku-is-working" class="md-nav__link">
    Test that Dokku is working
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optionally-set-proxies-for-docker" class="md-nav__link">
    Optionally set proxies for Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-domain-names" class="md-nav__link">
    Configure domain names
  </a>
  
    <nav class="md-nav" aria-label="Configure domain names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-a-domain-name" class="md-nav__link">
    Register a domain name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-subdomains" class="md-nav__link">
    Enable subdomains!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-test-app" class="md-nav__link">
    Deploy a test app
  </a>
  
    <nav class="md-nav" aria-label="Deploy a test app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone-the-test-app" class="md-nav__link">
    Clone the test app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-the-app-domain-and-ports" class="md-nav__link">
    Configure the app domain and ports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-your-data-app" class="md-nav__link">
    Deploy your data app
  </a>
  
    <nav class="md-nav" aria-label="Deploy your data app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-streamlit-app-skip-if-you-already-have-an-app" class="md-nav__link">
    Build a streamlit app (skip if you already have an app)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-project-specific-configuration-files-for-dokku" class="md-nav__link">
    Add project-specific configuration files for Dokku
  </a>
  
    <nav class="md-nav" aria-label="Add project-specific configuration files for Dokku">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirementstxt" class="md-nav__link">
    requirements.txt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procfile" class="md-nav__link">
    Procfile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-git-remote-with-dokku" class="md-nav__link">
    Configure git Remote with Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dokku-subdomain" class="md-nav__link">
    Configure Dokku Subdomain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dokku-port-mapping" class="md-nav__link">
    Configure Dokku port mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-it-out" class="md-nav__link">
    Test it out!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-static-site" class="md-nav__link">
    Deploy a static site
  </a>
  
    <nav class="md-nav" aria-label="Deploy a static site">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-static-site-skip-if-you-already-have-one" class="md-nav__link">
    Build a static site (skip if you already have one)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-project-specific-configuration-files-for-dokku_1" class="md-nav__link">
    Add project-specific configuration files for Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-git-remote-with-dokku_1" class="md-nav__link">
    Configure git Remote with Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dokku" class="md-nav__link">
    Configure Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging_1" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-framework" class="md-nav__link">
    The Framework
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cheatsheet-of-commands" class="md-nav__link">
    Cheatsheet of Commands
  </a>
  
    <nav class="md-nav" aria-label="Cheatsheet of Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-name-registration" class="md-nav__link">
    Domain Name Registration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streamlit-commands" class="md-nav__link">
    Streamlit Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-commands" class="md-nav__link">
    Git commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-with-proxies" class="md-nav__link">
    Interacting with proxies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-with-domains" class="md-nav__link">
    Interacting with domains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config-files" class="md-nav__link">
    Config Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../code-style-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Style Tools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software Skills
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Software Skills
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-skills/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Importance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-skills/code-formatting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formatting your code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-skills/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documenting your code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-skills/environment-variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A Data Scientist's Guide to Environment Variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-skills/refactoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refactoring your code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-skills/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing your code
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    People Skills
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            People Skills
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../people-skills/hiring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hiring and Interviewing Data Scientists
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Terminal Hacks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Terminal Hacks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../terminal/cli-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools and Upgrades for your CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../terminal/pre-commits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using pre-commit git hooks to automate code checks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workflow
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/code-review/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practicing Code Review
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/effective-commit-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Effective Git Commits in Data Science
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/gitflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Principled Git-based Workflow in Collaborative Data Science Projects
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../supporters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supporters
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#but-but-why" class="md-nav__link">
    But, but why?
  </a>
  
    <nav class="md-nav" aria-label="But, but why?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-youre-part-of-a-company" class="md-nav__link">
    If you're part of a company...
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-youre-doing-this-for-your-hobby-projects" class="md-nav__link">
    If you're doing this for your hobby projects...
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-generally" class="md-nav__link">
    More generally...
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-a-box-in-the-cloud-optional-if-you-have-one" class="md-nav__link">
    Set up a Box in the Cloud (optional if you have one)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-dokku-on-your-shiny-rented-machine" class="md-nav__link">
    Setup Dokku on your Shiny Rented Machine
  </a>
  
    <nav class="md-nav" aria-label="Setup Dokku on your Shiny Rented Machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-the-dokku-installation-commands" class="md-nav__link">
    Run the Dokku installation commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrap-up-dokku-installation" class="md-nav__link">
    Wrap up Dokku installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-that-dokku-is-working" class="md-nav__link">
    Test that Dokku is working
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optionally-set-proxies-for-docker" class="md-nav__link">
    Optionally set proxies for Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-domain-names" class="md-nav__link">
    Configure domain names
  </a>
  
    <nav class="md-nav" aria-label="Configure domain names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-a-domain-name" class="md-nav__link">
    Register a domain name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-subdomains" class="md-nav__link">
    Enable subdomains!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-test-app" class="md-nav__link">
    Deploy a test app
  </a>
  
    <nav class="md-nav" aria-label="Deploy a test app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone-the-test-app" class="md-nav__link">
    Clone the test app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-the-app-domain-and-ports" class="md-nav__link">
    Configure the app domain and ports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-your-data-app" class="md-nav__link">
    Deploy your data app
  </a>
  
    <nav class="md-nav" aria-label="Deploy your data app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-streamlit-app-skip-if-you-already-have-an-app" class="md-nav__link">
    Build a streamlit app (skip if you already have an app)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-project-specific-configuration-files-for-dokku" class="md-nav__link">
    Add project-specific configuration files for Dokku
  </a>
  
    <nav class="md-nav" aria-label="Add project-specific configuration files for Dokku">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirementstxt" class="md-nav__link">
    requirements.txt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procfile" class="md-nav__link">
    Procfile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-git-remote-with-dokku" class="md-nav__link">
    Configure git Remote with Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dokku-subdomain" class="md-nav__link">
    Configure Dokku Subdomain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dokku-port-mapping" class="md-nav__link">
    Configure Dokku port mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-it-out" class="md-nav__link">
    Test it out!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-static-site" class="md-nav__link">
    Deploy a static site
  </a>
  
    <nav class="md-nav" aria-label="Deploy a static site">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-static-site-skip-if-you-already-have-one" class="md-nav__link">
    Build a static site (skip if you already have one)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-project-specific-configuration-files-for-dokku_1" class="md-nav__link">
    Add project-specific configuration files for Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-git-remote-with-dokku_1" class="md-nav__link">
    Configure git Remote with Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-dokku" class="md-nav__link">
    Configure Dokku
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging_1" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-framework" class="md-nav__link">
    The Framework
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cheatsheet-of-commands" class="md-nav__link">
    Cheatsheet of Commands
  </a>
  
    <nav class="md-nav" aria-label="Cheatsheet of Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-name-registration" class="md-nav__link">
    Domain Name Registration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streamlit-commands" class="md-nav__link">
    Streamlit Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-commands" class="md-nav__link">
    Git commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-with-proxies" class="md-nav__link">
    Interacting with proxies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interacting-with-domains" class="md-nav__link">
    Interacting with domains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config-files" class="md-nav__link">
    Config Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="static-sites-and-apps-on-your-own-dokku-server">Static Sites and Apps On Your Own Dokku Server</h1>
<p><strong>Summary:</strong> In this essay,
I'm going to share with you how you can deploy
your own static sites and apps on a Dokku server.</p>
<h2 id="introduction">Introduction</h2>
<p>You've worked on this awesome Streamlit app,
or a Panel dashboard,
or a Plotly Dash web frontend for your data science work,
and now you've decided to share the work.
Or you've built documentation for the project,
and you need to serve it up.
Except, if your company doesn't have a dedicated platform for apps, you're stuck!
That's because you've now got to share it from your laptop/workstation
and point your colleagues to there
(right... go ahead and email them a link to <code>http://10.16.213.24:8501</code> right now...)
and keep your computer running perpetually
to serve the app in order for them to interact with it.</p>
<p>Or, you copy/paste the docs into a separate hosted solution,
and now the docs are divorced from your code,
leading to documentation rot in the long-run
because it's too troublesome to maintain two things simultaneously.
That's much too fragile.
What you need is another hosting machine
that isolated from your development machine,
so that you can develop in peace
while the hosting machine reliably serves up the working,
stable version of your work.</p>
<p>The specific thing that you <em>really</em> need is a "Platform as a Service".
There's a lot of commercial offerings,
but if you're "cheap" and don't mind learning some new concepts
to help you get around the web, then this essay is for you.
Here, I'm going to show you how to configure
and deploy Dokku as a personal PaaS solution
that you can use at work and for hobby projects.
I'm then going to show you how to deploy a static site
(which can be useful for hosting blogs and documentation),
and finally I'll show you how to deploy a Streamlit app,
which you can use to show off a front-end to your fancy modelling work.
Along the way, I hope to also point out the "generalizable" ideas
behind the steps listed here,
and give you a framework (at least, one useful one)
for building things on the web.</p>
<h2 id="but-but-why">But, but why?</h2>
<h3 id="if-youre-part-of-a-company">If you're part of a company...</h3>
<p>Your organization might not be equipped
with modern PaaS tools that will enable you, a data scientist,
to move quickly from local prototype to share-able prototype.
If, however, you have access to bare metal cloud resources
(i.e. just gimme a Linux box!),
then as a hacker-type,
you might be able to stand up your own PaaS
and help demonstrate to your infrastructure team the value of having one.</p>
<h3 id="if-youre-doing-this-for-your-hobby-projects">If you're doing this for your hobby projects...</h3>
<p>You might be as cheap as I am,
but need a bit more beefy power
than the restrictions given to you on Heroku
(512MB RAM, 30 minute timeouts,
and limited number of records in databases),
<em>and</em> you don't want to pay $7/month for each project.</p>
<p>Additionally, you might want a bit more control over your hosting options,
but you don't feel completely ready
to go fiddling with containers and networking
without a software stack to help out <em>just a bit</em>.</p>
<h3 id="more-generally">More generally...</h3>
<p>You might like the idea of containers,
but find it kind of troublesome to learn
<em>yet another thing that's not trivial to configure, execute and debug</em> (i.e. Docker).
Dokku can be a bridge to get you there,
as it automates much of the workflow surrounding Docker containers.
It also comes with an API that both matches closely to Heroku
(which is famous for being very developer-friendly)
and also helps you handle proxy port mapping and domains easily.</p>
<p>Are you ready? Let's go!</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>I'm assuming you know how to generate and use SSH keys
to remotely access another machine.
This is an incredibly useful thing to know how to do,
and so I'd recommend that you pick this skill up.
(As usual, DigitalOcean's community pages have
<a href="https://www.digitalocean.com/community/tutorials/how-to-use-ssh-to-connect-to-a-remote-server-in-ubuntu">a great tutorial</a>.)</p>
<p>I am also assuming that you have access to a Linux box of some kind
with an IP address that you can expose to the "internet".
The "internet" in this case can mean the world wide web
if you're working on a personal project,
or your organization's "intranet"
if you're planning on only letting those in your organization
access the sites and apps that you will build.</p>
<p>I'm also assuming familiarity with <code>git</code>,
which I consider to be an indispensable tool in a data scientist's toolkit.</p>
<p>This last point is not an assumption, but an exhortation:
you should be building your data app prototype
in accordance to 12-factor app principles.
It'll make (most of) your Engineering colleagues delight in working with you.
(Yes, there are some esoteric types that don't subscribe to 12 factor app principles...)
If you've never heard of it, <a href="https://12factor.net/">go check it out here</a>.
It's a wonderful read that will change
how you build your data app prototypes for the better.
It will also make handing over the app to Engineering
much easier in the long-run,
improving your relationship with the Engineering team
that will take care of your app!</p>
<h2 id="set-up-a-box-in-the-cloud-optional-if-you-have-one">Set up a Box in the Cloud (optional if you have one)</h2>
<p>If you don't already have another computer that you have access to,
or if you're curious on how to get set up in the cloud,
then follow along these instructions.</p>
<p>To make things a bit more concrete,
I'm going to rent a server on DigitalOcean (DO).
If you don't have a DigitalOcean account,
feel free to use my <a href="https://m.do.co/c/2832a2124e66">referral link</a> to sign up
(and get free $100 credits that you can spend over 60 days)
if you haven't got a DigitalOcean account already.
(Disclaimer: I benefit too,
but your support helps me make more of this kind of content!)
Once you've signed up and logged into the DigitalOcean cloud dashboard,
you can now set up a new Droplet.</p>
<details class="question">
<summary>Droplets?</summary>
<p>"Droplet" is nothing more than DO's fancy name for a cloud server,
or basically a computer that they're running.</p>
</details>
<p>To do so, click on the big green "Create" button,
set up a Droplet with the following settings:</p>
<ol>
<li>Ubuntu operating system</li>
<li>"Standard" plan at $5/mo or $10/mo <sup id="fnref:ram"><a class="footnote-ref" href="#fn:ram">1</a></sup></li>
<li>Additional options: "monitoring"</li>
<li>Authentication: you should use SSH keys (this is a pre-requisite for this essay).</li>
<li>Hostname: Give it something memorable.</li>
<li>Backups: Highly recommended. Give yourself peace of mind that you can rollback anytime.</li>
</ol>
<p>Once you're done with that,
hit the big green "Create Droplet" button
right at the bottom of the screen!</p>
<p>Once your droplet is set up,
you can go ahead and click on the "Manage &gt; Droplets" left menu item,
and that will bring you to a place
where you can see all of your rented computers.</p>
<details class="info">
<summary>The Cloud</summary>
<p>FYI, that's all the cloud is:
renting someone else's computers.
It turns out to be a pretty lucrative business!
And because it's just someone else's computers,
don't think of it as something magical.</p>
</details>
<h2 id="setup-dokku-on-your-shiny-rented-machine">Setup Dokku on your Shiny Rented Machine</h2>
<p>Let's now go ahead and set up Dokku on your shiny new droplet.</p>
<h3 id="run-the-dokku-installation-commands">Run the Dokku installation commands</h3>
<p>Dokku installation on Ubuntu is quite easy;
the following instructions are taken from the <a href="http://dokku.viewdocs.io/dokku/getting-started/installation/">Dokku docs</a>.
SSH into your machine, then type the following:</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/dokku/dokku/v0.20.4/bootstrap.sh<span class="p">;</span>
<span class="c1"># CHECK FOR LATEST DOKKU VERSION!</span>
<span class="c1"># http://dokku.viewdocs.io/dokku/getting-started/installation/</span>
sudo<span class="w"> </span><span class="nv">DOKKU_TAG</span><span class="o">=</span>v0.20.4<span class="w"> </span>bash<span class="w"> </span>bootstrap.sh
</code></pre></div>
<h3 id="wrap-up-dokku-installation">Wrap up Dokku installation</h3>
<p>If you're on an Ubuntu installation,
you'll want to navigate to your Linux box's IP address,
and finish up the installation instructions,
which involves letting your Dokku installation
know about your SSH public keys.
These keys are important,
as the are literally the <em>keys</em>
to letting you push your app to your Dokku box!</p>
<details class="info">
<summary>SSH Keys and Dokku</summary>
<p>More pedantically, these SSH keys identify your machine
as being "authorized" to push to the <code>git</code> server
that is running on your Dokku machine.
This is what allows you to <code>git push dokku master</code> later on!</p>
</details>
<p>For those of you who have CentOS or other flavours of Linux,
you will need to follow analogous instructions on the Dokku website.
I have had experience following the <a href="http://dokku.viewdocs.io/dokku/getting-started/install/rpm/">CentOS instructions</a> at work,
and had to modify the installation commands a little bit
to work with our internal proxies.</p>
<h3 id="test-that-dokku-is-working">Test that Dokku is working</h3>
<p>To test that your Dokku installation is working, type the following command:</p>
<div class="highlight"><pre><span></span><code>dokku<span class="w"> </span><span class="nb">help</span>
</code></pre></div>
<p>That should show the Dokku help menu,
and you'll know the installation has completed successfully!</p>
<h3 id="optionally-set-proxies-for-docker">Optionally set proxies for Docker</h3>
<p>Now, because Dokku builds upon Docker,
if you're behind a corporate proxy,
you might need to configure your Docker daemon proxies as well.
You'll then want to follow instructions
on the <a href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy">Docker daemon documentation</a>.</p>
<p>Those steps will generally be the same as what's in the docs,
though the specifics will change (e.g. your proxy server address).</p>
<h2 id="configure-domain-names">Configure domain names</h2>
<p>The allure of Heroku is that it gives your app a name:
<code>myapp.herokuapp.com</code>, or <code>myshinyapp.herokuapp.com</code> quite automagically.
With Dokku and a bit of extra legwork, we can replicate this facility.</p>
<p>We're going to set up your Dokku box
uch that its main domain will be <code>mydomain.com</code>,
and apps will get a subdomain <code>myapp.mydomain.com</code>.</p>
<h3 id="register-a-domain-name">Register a domain name</h3>
<p>Firstly, you'll need a domain name from a Domain Name Service (DNS) registrar.
Cloudflare seems to be doing all of the right things at the moment,
so <a href="https://www.cloudflare.com/products/registrar/">their domain name registration service</a>
is something I'm not hesitant to recommend (at least as of 2020).
For historical reasons, I'm currently using Google Domains.
At work, we have an internal service
that lets us register an internal domain name.
What matters most is that you have the ability
to assign a domain name that points to your Dokku machine's IP address.</p>
<p>Go ahead and register a domain name that reflects who "you" are on the web.
For myself, I have a personal domain name that I use.
At work, I registered a name that reflects the research group that I work in.
Make sure that the name "points"/"forwards" to the IP address of your Dokku box.</p>
<h3 id="enable-subdomains">Enable subdomains!</h3>
<p>To enable the ability to use subdomains like <code>myapp.mydomain.com</code> for each app,
you'll want to also configure the DNS settings.
On your domain registrar, look for the place
where you can customize "resource records".
On Google Domains, it's under "DNS &gt; Custom resource records".</p>
<p>There, you'll want to add an "A" record
(as opposed to other options that you might see,
like "CNAME", "AAAA", and others).
The "name" should be <code>*</code>, literally just an asterisk.
The IPv4 address should point to your Dokku machine.
This is all that is needed.</p>
<details class="question">
<summary>What is an 'A' record?</summary>
<p>The most comprehensive explainer I've seen is
at <a href="https://support.dnsimple.com/articles/a-record/">dnsimple</a>,
but the long story short is that it is an "Address" record.
Yes, "A" stands for "Address",
and it is nothing more than a pointer that maps
"string" address to IP address.</p>
</details>
<details class="question">
<summary>What then about the name <code>*</code>?</summary>
<p>What we just did up there was to say,
point everything <code>*.mydomain.com</code>
to to the Dokku box IP address.
How then do we get subdomains
if we don't configure them with our DNS?
Well, the secret here is that Dokku can help us with subdomains.
Read on for how configuration of your Dokku box!</p>
</details>
<p>To test whether your domain name is setup correctly,
head over to the domain in your favourite browser.
At this point, you should see the default NGINX landing page,
as you have no apps deployed and no domains configured.</p>
<details class="question">
<summary>How do you pronounce 'NGINX'?</summary>
<p>The official way is "engine-X".
The wrong way is "en-jinx".
Don't get it wrong!</p>
</details>
<details class="question">
<summary>And what is NGINX?</summary>
<p>From <a href="https://en.wikipedia.org/wiki/Nginx">Wikipedia</a>:</p>
<p>Nginx is a web server which can also be used as a reverse proxy,
load balancer, mail proxy and HTTP cache.</p>
<p>For our purposes, we treat it as a thing
that routes URLs to containers.</p>
</details>
<h2 id="deploy-a-test-app">Deploy a test app</h2>
<p>Heroku provides a "Python getting started" repository
that we will use to check that the installation is working correctly.
This one deploys reliably with all of the vanilla commands entered.
Leveraging this, I will also show you how to leverage your <code>*</code> A record
to put in nice subdomains!</p>
<h3 id="clone-the-test-app">Clone the test app</h3>
<p>Firstly, <code>git clone</code> Heroku's <a href="https://github.com/heroku/python-getting-started"><code>python-getting-started</code></a> repository
to your laptop/local machine (i.e. not your Dokku box).</p>
<p>Next, <code>cd</code> into the repository:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>python-getting-started
</code></pre></div>
<p>After that, add your Dokku box as a <code>git</code> remote to the repository:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>dokku<span class="w"> </span>dokku@your-domain-name:python-getting-started
</code></pre></div>
<p>Be sure to replace <code>your-domain-name</code> with your newfangled domain that you registered.</p>
<details class="info">
<summary>App name</summary>
<p>The <code>python-getting-started</code> after the colon
is the "app name" that you will see at the command line
when interacting with Dokku later.</p>
</details>
<p>Now, push the app to your Dokku box!</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>push<span class="w"> </span>dokku<span class="w"> </span>master
</code></pre></div>
<p>Unlike your usual pushes to GitHub, GitLab or Bitbucket,
you'll see a series of remote outputs being beamed back to your terminal.
What's happening here is the build of the app!
In particular, a Docker build is happening behind-the-scenes,
so your app is completely self-contained and containerized on the Dokku box!</p>
<p>If everything went well, the last output beamed back to you should look like:</p>
<div class="highlight"><pre><span></span><code><span class="o">=====</span>&gt;<span class="w"> </span>Application<span class="w"> </span>deployed:
<span class="w">       </span>http://mydomain.com:10161
</code></pre></div>
<p>Wonderful! Now let's go back to Dokku and configure your app.</p>
<h3 id="configure-the-app-domain-and-ports">Configure the app domain and ports</h3>
<p>We're now going to configure Dokku to recognize
which subdomains should point to which apps.</p>
<p>Firstly, get familiar with the Dokku domains command:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your Dokku box</span>
dokku<span class="w"> </span>domains:help
</code></pre></div>
<p>That should list out all of the Dokku <code>domains</code> sub-commands.</p>
<div class="highlight"><pre><span></span><code>Usage:<span class="w"> </span>dokku<span class="w"> </span>domains<span class="o">[</span>:COMMAND<span class="o">]</span>

Manage<span class="w"> </span>domains<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>the<span class="w"> </span>proxy

Additional<span class="w"> </span>commands:
<span class="w">    </span>domains:add<span class="w"> </span>&lt;app&gt;<span class="w"> </span>&lt;domain&gt;<span class="w"> </span><span class="o">[</span>&lt;domain&gt;<span class="w"> </span>...<span class="o">]</span><span class="w">       </span>Add<span class="w"> </span>domains<span class="w"> </span>to<span class="w"> </span>app
<span class="w">    </span>domains:add-global<span class="w"> </span>&lt;domain&gt;<span class="w"> </span><span class="o">[</span>&lt;domain&gt;<span class="w"> </span>...<span class="o">]</span><span class="w">      </span>Add<span class="w"> </span>global<span class="w"> </span>domain<span class="w"> </span>names
<span class="w">    </span>domains:clear<span class="w"> </span>&lt;app&gt;<span class="w">                             </span>Clear<span class="w"> </span>all<span class="w"> </span>domains<span class="w"> </span><span class="k">for</span><span class="w"> </span>app
<span class="w">    </span>domains:clear-global<span class="w">                            </span>Clear<span class="w"> </span>global<span class="w"> </span>domain<span class="w"> </span>names
<span class="w">    </span>domains:disable<span class="w"> </span>&lt;app&gt;<span class="w">                           </span>Disable<span class="w"> </span>VHOST<span class="w"> </span>support
<span class="w">    </span>domains:enable<span class="w"> </span>&lt;app&gt;<span class="w">                            </span>Enable<span class="w"> </span>VHOST<span class="w"> </span>support
<span class="w">    </span>domains:remove<span class="w"> </span>&lt;app&gt;<span class="w"> </span>&lt;domain&gt;<span class="w"> </span><span class="o">[</span>&lt;domain&gt;<span class="w"> </span>...<span class="o">]</span><span class="w">    </span>Remove<span class="w"> </span>domains<span class="w"> </span>from<span class="w"> </span>app
<span class="w">    </span>domains:remove-global<span class="w"> </span>&lt;domain&gt;<span class="w"> </span><span class="o">[</span>&lt;domain&gt;<span class="w"> </span>...<span class="o">]</span><span class="w">   </span>Remove<span class="w"> </span>global<span class="w"> </span>domain<span class="w"> </span>names
<span class="w">    </span>domains:report<span class="w"> </span><span class="o">[</span>&lt;app&gt;<span class="p">|</span>--global<span class="o">]</span><span class="w"> </span><span class="o">[</span>&lt;flag&gt;<span class="o">]</span><span class="w">        </span>Displays<span class="w"> </span>a<span class="w"> </span>domains<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span>one<span class="w"> </span>or<span class="w"> </span>more<span class="w"> </span>apps
<span class="w">    </span>domains:set<span class="w"> </span>&lt;app&gt;<span class="w"> </span>&lt;domain&gt;<span class="w"> </span><span class="o">[</span>&lt;domain&gt;<span class="w"> </span>...<span class="o">]</span><span class="w">       </span>Set<span class="w"> </span>domains<span class="w"> </span><span class="k">for</span><span class="w"> </span>app
<span class="w">    </span>domains:set-global<span class="w"> </span>&lt;domain&gt;<span class="w"> </span><span class="o">[</span>&lt;domain&gt;<span class="w"> </span>...<span class="o">]</span><span class="w">      </span>Set<span class="w"> </span>global<span class="w"> </span>domain<span class="w"> </span>names
</code></pre></div>
<p>You can report domains used for the app, <code>python-getting-started</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your Dokku box</span>
dokku<span class="w"> </span>domains:report<span class="w"> </span>python-getting-started
</code></pre></div>
<p>The output should look something like this:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>dokku<span class="w"> </span>domains:report<span class="w"> </span>python-getting-started
<span class="o">=====</span>&gt;<span class="w"> </span>python-getting-started<span class="w"> </span>domains<span class="w"> </span>information
<span class="w">       </span>Domains<span class="w"> </span>app<span class="w"> </span>enabled:<span class="w">           </span><span class="nb">false</span>
<span class="w">       </span>Domains<span class="w"> </span>app<span class="w"> </span>vhosts:
<span class="w">       </span>Domains<span class="w"> </span>global<span class="w"> </span>enabled:<span class="w">        </span><span class="nb">false</span>
<span class="w">       </span>Domains<span class="w"> </span>global<span class="w"> </span>vhosts:
</code></pre></div>
<p>This tells us that <code>python-getting-started</code>
has no domains configured for it.
We can now set it:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your Dokku box</span>
dokku<span class="w"> </span>domains:set<span class="w"> </span>python-getting-started<span class="w"> </span>python-getting-started.mydomain.com
</code></pre></div>
<p>The output will look like this:</p>
<div class="highlight"><pre><span></span><code>-----&gt;<span class="w"> </span>Added<span class="w"> </span>python-getting-started.mydomain.com<span class="w"> </span>to<span class="w"> </span>python-getting-started
-----&gt;<span class="w"> </span>Configuring<span class="w"> </span>python-getting-started.mydomain.com...<span class="o">(</span>using<span class="w"> </span>built-in<span class="w"> </span>template<span class="o">)</span>
-----&gt;<span class="w"> </span>Creating<span class="w"> </span>http<span class="w"> </span>nginx.conf
<span class="w">       </span>Reloading<span class="w"> </span>nginx
</code></pre></div>
<p>Now, you should be able to go to <code>http://python-getting-started.mydomain.com</code>,
and the page that gets loaded should be
the "Getting Started with Python on Heroku" landing page!</p>
<details class="question">
<summary>So, what magic happened here?</summary>
<p>What's happening here is that NGINX resolving
subdomains to particular containers,
and mapping them to the appropriate container port
that is being exposed.</p>
</details>
<p>If everything deployed correctly up till this point,
you're good to go with deploying a data app on your Dokku machine!</p>
<h2 id="deploy-your-data-app">Deploy your data app</h2>
<p>Deploying the <code>python-getting-started</code> app should have given you:</p>
<ol>
<li>the confidence that your Dokku installation is working correctly,</li>
<li>firsthand experience configuring Dokku,</li>
<li>a taste of the workflow for deploying an app.</li>
</ol>
<p>Now, we're going to apply that to a Streamlit app.
I've chosen Streamlit because it's got the easiest programming model
amongst all of the Dashboard/app development frameworks that I've seen;
in fact, I was able to stand up an <a href="https://minimal-streamlit.herokuapp.com/">explainer on the Beta distribution</a>
in under 3 hours,
the bulk of which was spent on writing prose,
not figuring out how to program with Streamlit.</p>
<h3 id="build-a-streamlit-app-skip-if-you-already-have-an-app">Build a streamlit app (skip if you already have an app)</h3>
<p>If you don't have a Streamlit app,
here's one that you can use as a starter,
which simply displays some text and a button:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># app.py</span>

<span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># First Streamlit App!</span>

<span class="sd">This is a dummy streamlit app.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">finished</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Click me!&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">finished</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">balloons</span><span class="p">()</span>
</code></pre></div>
<p>Save it as <code>app.py</code> in your project directory.</p>
<p>Now, you can run the app with Streamlit:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
streamlit<span class="w"> </span>run<span class="w"> </span>app.py
</code></pre></div>
<p>You should see the following show up in your terminal:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>You<span class="w"> </span>can<span class="w"> </span>now<span class="w"> </span>view<span class="w"> </span>your<span class="w"> </span>Streamlit<span class="w"> </span>app<span class="w"> </span><span class="k">in</span><span class="w"> </span>your<span class="w"> </span>browser.
<span class="w">  </span>Local<span class="w"> </span>URL:<span class="w"> </span>http://localhost:8501
<span class="w">  </span>Network<span class="w"> </span>URL:<span class="w"> </span>http://&lt;your_ip_address&gt;:8501
</code></pre></div>
<p>You can go to the local URL and confirm that the app is running correctly,
and that it does exactly what's expected.</p>
<h3 id="add-project-specific-configuration-files-for-dokku">Add project-specific configuration files for Dokku</h3>
<p>Now, we need to add a few configuration files that Dokku will recognize.</p>
<h4 id="requirementstxt"><code>requirements.txt</code></h4>
<p>Firstly, make sure you have a <code>requirements.txt</code> file in the project root directory,
in which you specify all of the requirements for your app to run.</p>
<div class="highlight"><pre><span></span><code># requirements.txt
streamlit==0.57.3  # pinning version numbers is good for apps.
# put more below as necessary, e.g.:
numpy==0.16
</code></pre></div>
<p>With a <code>requirements.txt</code> file,
Dokku (and Heroku) will automagically recognize that you have a Python app.
Dokku will then create a Docker container equipped with Python,
and install all of the dependencies in there.
Declarative configuration FTW!</p>
<h4 id="procfile"><code>Procfile</code></h4>
<p>Next, you need a Procfile in the project root directory:</p>
<div class="highlight"><pre><span></span><code># Procfile
web: streamlit run app.py
</code></pre></div>
<details class="note">
<summary>Procfile</summary>
<p>A quick note: It is <code>Procfile</code>, with no file extensions.
Don't save it as <code>Procfile.txt</code>,
because that will not get recognized by Dokku/Heroku.
To learn more, read about it on
<a href="https://devcenter.heroku.com/articles/procfile">Heroku</a>.</p>
</details>
<p>The <em>general</em> syntax in the Procfile is:</p>
<div class="highlight"><pre><span></span><code>&lt;process_type&gt;: &lt;command&gt;
</code></pre></div>
<p>The <code>command</code> is always a single line,
and tells Dokku/Heroku what commands to execute in order to run the app.
In our case, we simply execute the same command
that we used to run the app locally for development purposes.</p>
<details class="note">
<summary>More complex Procfile commands</summary>
<p>You can have multiple bash commands in a single line,
though if it gets complicated,
you may want to extract the commands out
into a separate bash script that you execute instead, e.g.:</p>
<div class="highlight"><pre><span></span><code># dokku.sh
pip install -e .
export CONFIG_DIR=&quot;/path/to/config/files&quot;
streamlit run app.py
</code></pre></div>
</details>
<p>For the <code>process_type</code>, in the case of Dokku, is always "web".
Heroku, on the other hand, can handle other process types.
Since we're dealing with Dokku and not Heroku,
don't bother changing <code>process_type</code>.</p>
<h3 id="configure-git-remote-with-dokku">Configure <code>git</code> Remote with Dokku</h3>
<p>Now, let's configure your Dokku remote.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>dokku<span class="w"> </span>dokku@mydomain.com:streamlit-app
</code></pre></div>
<p>Remember two points!</p>
<ol>
<li>Firstly, change <code>mydomain.com</code> to your domain.</li>
<li>Secondly, you can use <em>any</em> app name you want, it doesn't have to be <code>streamlit-app</code>.</li>
</ol>
<p>A convention that has helped me is to have a 1:1 mapping
between app and project repository folder name.
It means one less thing to be confused about.</p>
<p>Once you're done configuring the remote, now push it up!</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
git<span class="w"> </span>push<span class="w"> </span>dokku<span class="w"> </span>master
</code></pre></div>
<p>The same build commands will take place.
While they are taking place, go ahead and open a new Terminal,
and SSH into the Dokku box.
We're going to configure the new app on Dokku!</p>
<h3 id="configure-dokku-subdomain">Configure Dokku Subdomain</h3>
<p>Let's start with the subdomain name first.
For this tutorial, I'm going to use the domain name <code>streamlit-app.mydomain.com</code>.
Let's configure the app <code>streamlit-app</code> with that domain name:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On Dokku box</span>
dokku<span class="w"> </span>domains:set<span class="w"> </span>streamlit-app<span class="w"> </span>streamlit-app.mydomain.com
</code></pre></div>
<h3 id="configure-dokku-port-mapping">Configure Dokku port mapping</h3>
<p>Next, we have to configure the port mapping that Dokku's proxy server will recognize.
By default, every container has the "hosting box" (i.e. the machine Dokku is running on)
port 80 mapped to "container box" (i.e. the container the <em>app</em> is running on) port 5000.
You can see this with:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On Dokku box</span>
dokku<span class="w"> </span>proxy:report<span class="w"> </span>streamlit-app
</code></pre></div>
<p>That will give you something like:</p>
<div class="highlight"><pre><span></span><code><span class="o">=====</span>&gt;<span class="w"> </span>python-getting-started<span class="w"> </span>proxy<span class="w"> </span>information
<span class="w">       </span>Proxy<span class="w"> </span>enabled:<span class="w">                 </span><span class="nb">true</span>
<span class="w">       </span>Proxy<span class="w"> </span>port<span class="w"> </span>map:<span class="w">                </span>http:80:5000
<span class="w">       </span>Proxy<span class="w"> </span>type:<span class="w">                    </span>nginx
</code></pre></div>
<p>Now, because <code>streamlit</code> is going to be run on port 8501 (in the container) by default,
we need to change the port mapping from <code>http:80:5000</code> to <code>http:80:8501</code>.
To do so:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On Dokku box</span>
dokku<span class="w"> </span>proxy:ports-set<span class="w"> </span>streamlit-app<span class="w"> </span>http:80:8501
</code></pre></div>
<p>Putting these two configurations together,
i.e. setting the subdomain and port mapping,
we have now told Dokku, "Each time you get a request from <code>http://streamlit-app.mydomain.com</code>,
forward it to port 8501 on the <code>streamlit-app</code> container."</p>
<h3 id="test-it-out">Test it out!</h3>
<p>Well, we now can test it out.
Go ahead and head over to your app URL,
and see if the app works for you!</p>
<h3 id="debugging">Debugging</h3>
<p>If things look like they're crashing, how do you debug?
Well, you always should know how to look at the logs:</p>
<div class="highlight"><pre><span></span><code>dokku<span class="w"> </span>logs<span class="w"> </span>my_app_name<span class="w"> </span>-t
</code></pre></div>
<p>That will keep the logs updating in the terminal as you refresh the page.
Use the information in the logs to help you debug.
Also, see if you can reproduce the error in the logs locally.</p>
<p>Additionally, if you get <code>nginx</code> errors,
you can look at the <code>nginx</code> logs to help you debug
proxy errors as they show up:</p>
<div class="highlight"><pre><span></span><code>dokku<span class="w"> </span>nginx:access-logs<span class="w"> </span>my_app_name<span class="w"> </span>-t
</code></pre></div>
<p>Look at the logs and dig through for anything
that might help you with your Google searches.
Follow this pattern, and soon enough,
you'll become an expert at debugging your web apps!</p>
<h2 id="deploy-a-static-site">Deploy a static site</h2>
<p>Now that you've seen how to deploy an app
that's powered by a container behind-the-scenes,
let's now figure out how to deploy a static site
that is built upon every deploy.
It's essentially the same.
We have configuration files (in this case, slightly different ones)
that declare what kind of environment we need.
We basically treat the static site generator
as an "app" that generates the HTML pages
that we serve up freshly on each build.</p>
<p>For this example, I'm going to use <a href="https://www.mkdocs.org/"><code>mkdocs</code></a>,
as it is also easy to use to build sites,
and can be extended with some pretty awesome templates
(like <a href="https://squidfunk.github.io/mkdocs-material/"><code>mkdocs-material</code></a>)
for responsive docs generated from Markdown files.
If you've got another static site builder
(I have used <a href="https://www.getlektor.com/">Lektor</a>, <a href="https://www.sphinx-doc.org/en/master/">sphinx</a>, and <a href="https://getnikola.com/">Nikola</a> before),
the places where we use <code>mkdocs</code> commands
can be easily replaced by the relevant ones for your situation.</p>
<h3 id="build-a-static-site-skip-if-you-already-have-one">Build a static site (skip if you already have one)</h3>
<p>If you don't already have a static site,
then feel free to use the following example.</p>
<p>In your project root directory,
create a <code>docs/</code> directory,
and then place a dummy <code>index.md</code> in there:</p>
<div class="highlight"><pre><span></span><code>&lt;!-- index.md --&gt;
<span class="gh"># Index Page</span>

Hello world!
</code></pre></div>
<p>Now, in the project root directory,
create a <code>mkdocs.yml</code> file,
in which you configure <code>mkdocs</code> to build the static site:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># mkdocs.yml</span>
<span class="nt">site_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Marshmallow Generator</span>
</code></pre></div>
<p>This is a minimal <code>mkdocs</code> configuration.</p>
<p>Now, make sure you have mkdocs installed
in the Python environment that you're using.
It's available on PyPI:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mkdocs
</code></pre></div>
<p>Once installation has finished,
you can now command <code>mkdocs</code> to build the static site to view locally:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
mkdocs<span class="w"> </span>serve
</code></pre></div>
<p>If you can successfully view the static site on your local machine,
i.e. you see the contents of <code>index.md</code>
show up as a beautifully rendered HTML page,
you're good to move on!</p>
<h3 id="add-project-specific-configuration-files-for-dokku_1">Add project-specific configuration files for Dokku</h3>
<p>We're now going to add the necessary configuration files to work with Dokku.</p>
<p>Firstly, we have to add in a <code>.static</code> file in the project root directory.
This file tells Dokku that the site that is going to be built is a static site.
To do so in the terminal, you only have to <code>touch</code> the file at the command line:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
touch<span class="w"> </span>.static
</code></pre></div>
<p>Secondly, we have to add a <code>.buildpacks</code> file,
where we specify that we are using two "buildpacks":
one to provide the environment to run the commands that build the site,
and another to build the site and serve up the static site files.
In the case of our dummy <code>mkdocs</code> static sites, we need in <code>.buildpacks</code>:</p>
<div class="highlight"><pre><span></span><code>https://github.com/heroku/heroku-buildpack-python.git
https://github.com/dokku/buildpack-nginx.git
</code></pre></div>
<p>They have to go in that order, so that the first one is used for building, and the second one is used for serving the site.</p>
<details class="question">
<summary>What are 'buildpacks?</summary>
<p>Once again, Heroku's docs have <a href="https://devcenter.heroku.com/articles/buildpacks">the most comprehensive explanation</a>,
as they're the originators of the idea.
The short answer is that they are pre-built and configured "base" environments
that you can build off.
It's like having an opinionated Dockerfile that you can extend,
except we extend it using declared configuration files in the repository instead.</p>
</details>
<p>Thirdly, instead of a <code>Procfile</code>,
we add an <code>app.json</code> file that contains the command
for building the static site.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;dokku&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;predeploy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cd /app/www &amp;&amp; mkdocs build&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<details class="question">
<summary>Deployment tasks</summary>
<p>If you want to read more about this file,
as well as the custom "deployment tasks" bit of Dokku,
then check out the <a href="http://dokku.viewdocs.io/dokku/advanced-usage/deployment-tasks/">docs pages here</a>.)</p>
</details>
<p>OK, we just created a bunch of files,
but I haven't explained how they're interacting with Dokku.
There's definitely some opinionated things that we'll have to unpack.</p>
<p>Firstly, the Dokku <code>buildpack-nginx</code> buildpack
makes the opinionated assumption that your repository
will be copied over into the Docker container's <code>/app/www</code> directory.
That is why we have the <code>cd /app/www</code> command.
Then, we follow it up with a <code>mkdocs build</code>,
which you can change depending on what static site generator you're using.</p>
<p>Secondly, the <code>predeploy</code> key declares to Dokku
to execute the commands in the value (i.e. <code>cd /app/www &amp;&amp; mkdocs build</code>)
before starting up the <code>nginx</code> server that points to the static site files.</p>
<p>As you probably can grok by now, basically,
the static sites are being built upon every deploy.
This saves you from having to build the site locally and then pushing it up,
which is both in-line with how <code>git</code> is supposed to be used
(you only <code>git push</code> files that are generated by hand),
and is in-line with the continuous deployment philosophy.</p>
<p>Finally, we still need our <code>requirements.txt</code> file
to be populated with whatever is needed to build the docs locally:</p>
<div class="highlight"><pre><span></span><code># requirements.txt
mkdocs==1.1
# put other dependencies below!
</code></pre></div>
<p>Now that we're done, let's configure our remotes once again.</p>
<h3 id="configure-git-remote-with-dokku_1">Configure <code>git</code> Remote with Dokku</h3>
<p>As with the Streamlit app, go ahead and configure the <code>git</code> remote with Dokku:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>dokku<span class="w"> </span>dokku@mydomain.com:my-static-site
</code></pre></div>
<p>Now, push up to Dokku!</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your local machine</span>
git<span class="w"> </span>push<span class="w"> </span>dokku<span class="w"> </span>master
</code></pre></div>
<h3 id="configure-dokku">Configure Dokku</h3>
<p>As with the Streamlit app, let's now configure the domains:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your Dokku box</span>
dokku<span class="w"> </span>domains:set<span class="w"> </span>my-static-site<span class="w"> </span>my-static-site.mydomain.com
</code></pre></div>
<p>Unlike the app, we don't have to configure ports,
because they will be mapped correctly by default.</p>
<p>Finally, we need to configure <code>nginx</code>
to point to the directory in which the <code>index.html</code> page is generated.
In the case of <code>mkdocs</code>,
the directory is in the <code>site/</code> directory in the project root directory.
We'll now configure it:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># On your Dokku box</span>
dokku<span class="w"> </span>config:set<span class="w"> </span>my-static-site<span class="w"> </span><span class="nv">NGINX_ROOT</span><span class="o">=</span><span class="s1">&#39;site&#39;</span>
</code></pre></div>
<details class="warning" open="open">
<summary>Warning</summary>
<p>You'll want to change <code>site</code>
to whatever the output directory is
for the static site generator you use!</p>
</details>
<p>Alrighty, go ahead and visit your static site to confirm that it's running!</p>
<h3 id="debugging_1">Debugging</h3>
<p>As with the Streamlit app above,
debugging is done in exactly the same way,
using the two commands:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Inspect application logs</span>
dokku<span class="w"> </span>logs<span class="w"> </span>my_app_name<span class="w"> </span>-t
<span class="c1"># Inspect nginx logs</span>
dokku<span class="w"> </span>nginx:access-logs<span class="w"> </span>my_app_name<span class="w"> </span>-t
</code></pre></div>
<h2 id="the-framework">The Framework</h2>
<p>I have a habit of categorizing things into a "framework"
to help me anchor how I debug things,
and I hope to share my framework for domains, apps, and Dokku with you.</p>
<p>Firstly, we organized our Dokku box + domain name
such that the Dokku box was referenced by the domain name,
while individual apps got subdomains.
We got subdomains for free by configuring a <code>*</code>
on the DNS provider's A records,
which forwarded all sub-domains to the Dokku box.</p>
<p>Secondly, we configured each app on the Dokku box
to resolve which subdomain points to it.
In this way, subdomains need not be set on our DNS provider.</p>
<p>Thirdly, we configured both static sites and dynamic data apps,
using a collection of configuration files.
For our data apps, it was primarily a <code>Procfile</code> and <code>requirements.txt</code>.
For our static sites, it was a <code>.buildpacks</code> file,
<code>app.json</code> file, and <code>requirements.txt</code>.
Each have their purpose, but together they tell Dokku
how to configure the environment in which apps are built.</p>
<h2 id="cheatsheet-of-commands">Cheatsheet of Commands</h2>
<p>Here's a cheatsheet of commands we used in this essay,
to help you with getting set up.</p>
<h3 id="domain-name-registration">Domain Name Registration</h3>
<ul>
<li>Register your domain.</li>
<li>Add a custom resource record <code>*</code> pointing to your Dokku box's IP address</li>
</ul>
<h3 id="streamlit-commands">Streamlit Commands</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Run streamlit app</span>
streamlit<span class="w"> </span>run<span class="w"> </span>app.py
</code></pre></div>
<h3 id="git-commands">Git commands</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Add dokku remote</span>
git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>dokku<span class="w"> </span>dokku@mydomain.com:streamlit-app

<span class="c1"># Push master branch to Dokku box</span>
git<span class="w"> </span>push<span class="w"> </span>dokku<span class="w"> </span>master
</code></pre></div>
<h3 id="interacting-with-proxies">Interacting with proxies</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># View port forwarding for app</span>
dokku<span class="w"> </span>proxy:report<span class="w"> </span>streamlit-app

<span class="c1"># Set port forarding for app</span>
dokku<span class="w"> </span>proxy:ports-set<span class="w"> </span>streamlit-app<span class="w"> </span>http:80:8501
</code></pre></div>
<p>The syntax for the ports is:</p>
<div class="highlight"><pre><span></span><code>&lt;protocol&gt;:&lt;host<span class="w"> </span>port&gt;:&lt;container<span class="w"> </span>port&gt;
</code></pre></div>
<p>For port forwarding,
if you follow the general framework we're using here,
you should only have to configure the container port.</p>
<h3 id="interacting-with-domains">Interacting with domains</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># View domains for an app</span>
dokku<span class="w"> </span>domains:report<span class="w"> </span>streamlit-app

<span class="c1"># Set domains for an app</span>
dokku<span class="w"> </span>domains:set<span class="w"> </span>streamlit-app<span class="w"> </span>streamlit-app.mydomain.com
</code></pre></div>
<p>Again, if you follow the framework we have used here,
then you should only need to configure <code>&lt;app-url&gt;.mydomain.com</code></p>
<h3 id="config-files">Config Files</h3>
<p><code>Procfile</code> for apps</p>
<div class="highlight"><pre><span></span><code>web: streamlit run app.py
</code></pre></div>
<p><code>mkdocs.yml</code> for MkDocs config</p>
<div class="highlight"><pre><span></span><code><span class="c1"># mkdocs.yml</span>
<span class="nt">site_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Marshmallow Generator</span>
</code></pre></div>
<p>Create <code>.static</code> for static sites:</p>
<div class="highlight"><pre><span></span><code>touch<span class="w"> </span>.static
</code></pre></div>
<p><code>.buildpacks</code> for static sites and multi-buildpack apps</p>
<div class="highlight"><pre><span></span><code>https://github.com/heroku/heroku-buildpack-python.git
https://github.com/dokku/buildpack-nginx.git
</code></pre></div>
<p><code>app.json</code> for static sites:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;dokku&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;predeploy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cd /app/www &amp;&amp; mkdocs build&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="footnote">
<hr />
<ol>
<li id="fn:ram">
<p>I am paying for the $10/mo plan for the extra RAM seems to help.&#160;<a class="footnote-backref" href="#fnref:ram" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="http://www.shortwhale.com/ericmjl" target="_blank" rel="noopener" title="www.shortwhale.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/ericmjl" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ericmjl" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/ericmjl" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>